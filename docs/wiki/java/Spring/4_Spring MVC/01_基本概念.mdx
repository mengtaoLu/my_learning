import React, { useState } from 'react';
import {
    Share2,
    Settings,
    ShieldAlert,
    Zap,
    Database,
    Layers,
    ChevronRight,
    ChevronDown,
    ExternalLink,
    Code
} from 'lucide-react';

export const MindMapNode = ({ title, children, icon: Icon, color }) => {
    const [isOpen, setIsOpen] = useState(true);

return (
    <div className="flex flex-col mb-4">
      <div
        className={`flex items-center p-3 rounded-lg border-2 ${color.bg} ${color.border} cursor-pointer transition-all hover:shadow-md`}
        onClick={() => setIsOpen(!isOpen)}
      >
        <div className={`p-2 rounded-md ${color.iconBg} mr-3 text-white`}>
          <Icon size={20} />
        </div>
        <span className="font-bold text-gray-800 flex-grow">{title}</span>
        {isOpen ? <ChevronDown size={18} /> : <ChevronRight size={18} />}
      </div>

      {isOpen && (
        <div className="ml-8 mt-2 pl-4 border-l-2 border-dashed border-gray-300 space-y-2">
          {children}
        </div>
      )}
    </div>
);
};

export const LeafNode = ({ text, subtext }) => (
<div className="bg-white p-2 rounded border border-gray-200 shadow-sm hover:bg-gray-50 transition-colors">
    <div className="text-sm font-semibold text-gray-700">{text}</div>
    {subtext && <div className="text-xs text-gray-500 mt-1">{subtext}</div>}
</div>
);

<div className="min-h-screen bg-gray-100 p-4 md:p-8 font-sans">
    <div className="max-w-4xl mx-auto">
        {/* Header */}
        <div className="text-center mb-10">
            <h1 className="text-3xl font-bold text-gray-900 mb-2">Spring MVC 核心知识体系</h1>
            <p className="text-gray-600">从核心原理到高级扩展的全面掌握路径</p>
            <div className="flex justify-center mt-4 space-x-2">
                <span className="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">架构原理</span>
                <span className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium">生产实践</span>
                <span className="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium">源码深度</span>
            </div>
        </div>

        {/* Mind Map Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">

            {/* Section 1: Core Architecture */}
            <MindMapNode
                title="1. 核心架构与流程"
                icon={Layers}
                color={{ bg: 'bg-blue-50', border: 'border-blue-200', iconBg: 'bg-blue-500' }}
            >
                <LeafNode text="DispatcherServlet" subtext="整个 MVC 的大脑，前端控制器" />
                <LeafNode text="HandlerMapping" subtext="根据 URL 找到对应的 Controller 方法" />
                <LeafNode text="HandlerAdapter" subtext="适配器模式实现，支持不同类型的处理器执行" />
                <LeafNode text="ViewResolver" subtext="视图解析（前后端分离模式下主要处理静态资源）" />
                <LeafNode text="核心执行流程" subtext="理解从 Request 到 Response 的全生命周期路径" />
            </MindMapNode>

            {/* Section 2: Data Handling */}
            <MindMapNode
                title="2. 数据绑定与校验"
                icon={Database}
                color={{ bg: 'bg-green-50', border: 'border-green-200', iconBg: 'bg-green-500' }}
            >
                <LeafNode text="参数接收注解" subtext="@RequestParam, @PathVariable, @RequestBody" />
                <LeafNode text="数据校验 (Validation)" subtext="JSR-303/Hibernate Validator 深度集成" />
                <LeafNode text="Converter & Formatter" subtext="实现自定义类型转换逻辑（如日期、枚举）" />
                <LeafNode text="WebDataBinder" subtext="@InitBinder 实现参数预处理及属性编辑器" />
            </MindMapNode>

            {/* Section 3: Request & Response */}
            <MindMapNode
                title="3. 请求响应处理"
                icon={Zap}
                color={{ bg: 'bg-yellow-50', border: 'border-yellow-200', iconBg: 'bg-yellow-500' }}
            >
                <LeafNode text="HttpMessageConverter" subtext="Jackson/Gson 处理 JSON 序列化与反序列化" />
                <LeafNode text="内容协商 (Content Negotiation)" subtext="根据 Accept 头返回不同格式的数据" />
                <LeafNode text="结果统一封装" subtext="通过 ResponseBodyAdvice 实现全局结果包装" />
                <LeafNode text="静态资源处理" subtext="ResourceHandlerRegistry 配置与缓存优化" />
            </MindMapNode>

            {/* Section 4: AOP & Extensions */}
            <MindMapNode
                title="4. 切面扩展机制"
                icon={Share2}
                color={{ bg: 'bg-purple-50', border: 'border-purple-200', iconBg: 'bg-purple-500' }}
            >
                <LeafNode text="HandlerInterceptor" subtext="拦截器实现（Pre/Post/After）" />
                <LeafNode text="Filter 过滤器" subtext="Servlet 级别拦截（与 Interceptor 的本质区别）" />
                <LeafNode text="ControllerAdvice" subtext="全局 Controller 增强，常用于全局配置" />
                <LeafNode text="跨域处理 (CORS)" subtext="@CrossOrigin 与 WebMvcConfigurer 配置" />
            </MindMapNode>

            {/* Section 5: Robustness */}
            <MindMapNode
                title="5. 健壮性与异常处理"
                icon={ShieldAlert}
                color={{ bg: 'bg-red-50', border: 'border-red-200', iconBg: 'bg-red-500' }}
            >
                <LeafNode text="@ExceptionHandler" subtext="方法级/Controller 级异常捕获" />
                <LeafNode text="全局异常处理器" subtext="@RestControllerAdvice 实现统一错误返回" />
                <LeafNode text="HandlerExceptionResolver" subtext="底层异常解析接口自定义扩展" />
                <LeafNode text="ErrorController" subtext="自定义 404/500 等容器级别错误页面" />
            </MindMapNode>

            {/* Section 6: Advanced & Config */}
            <MindMapNode
                title="6. 进阶与自动化"
                icon={Settings}
                color={{ bg: 'bg-gray-50', border: 'border-gray-300', iconBg: 'bg-gray-600' }}
            >
                <LeafNode text="WebMvcConfigurer" subtext="代码式配置 MVC 的所有行为" />
                <LeafNode text="异步请求处理" subtext="Callable 与 DeferredResult 的应用场景" />
                <LeafNode text="MockMvc 单元测试" subtext="无需启动容器的接口集成测试" />
                <LeafNode text="执行链源码分析" subtext="深度研究 DispatcherServlet.doDispatch 逻辑" />
            </MindMapNode>

        </div>

        {/* Footer info */}
        <div className="mt-12 bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
            <h2 className="text-lg font-bold text-gray-800 mb-4 flex items-center">
                <Code className="mr-2 text-indigo-500" size={20} />
                学习建议
            </h2>
            <ul className="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                <li className="flex items-start">
                    <span className="text-indigo-500 font-bold mr-2">01.</span>
                    <span>先理解 **DispatcherServlet** 的分发逻辑，这是理解所有组件协同工作的前提。</span>
                </li>
                <li className="flex items-start">
                    <span className="text-indigo-500 font-bold mr-2">02.</span>
                    <span>重点掌握 **HttpMessageConverter**，这在现代 RESTful 开发中是最高频的自定义点。</span>
                </li>
                <li className="flex items-start">
                    <span className="text-indigo-500 font-bold mr-2">03.</span>
                    <span>通过 **WebMvcConfigurer** 尝试一次全代码配置，替代传统的 XML 或 Spring Boot 默认配置。</span>
                </li>
                <li className="flex items-start">
                    <span className="text-indigo-500 font-bold mr-2">04.</span>
                    <span>利用 **MockMvc** 编写测试用例，强制自己从调用方视角理解接口设计的合理性。</span>
                </li>
            </ul>
        </div>
    </div>
</div>